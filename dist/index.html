<!DOCTYPE html>
<html lang="en">

<head>
    <title>在线用户测试</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body style="padding: 4em">
    <h2>设置房间</h2>
    <label for="room-input">房间:&emsp;</label><input type="text" id="room-input" />

    <h2>在线用户状态</h2>
    <p>在线用户: <span style="color: red;" id="online_user"></span></p>
    <p>我的在线时间: <span style="color: red;" id="online_me"></span></p>
    <p>总在线时间: <span style="color: red;" id="online_total"></span></p>
</body>
<script>
    let room = localStorage.getItem('room') || ''
    let roomInput = document.getElementById('room-input')

    roomInput.value = room

    getOnlineUser()
    roomInput.addEventListener('change', function (e) {
       localStorage.setItem('room', e.target.value)
       location.reload()
    })

    function getOnlineUser() {
        //create script
        let script = document.createElement('script')
        script.src = '/counter.js'
        script.async = true
        script.id = 'online-counter'
        script.setAttribute('interval', 500)
        script.setAttribute('api', '/counter')
        script.setAttribute('room', room)
        document.head.appendChild(script)
    }
</script>

</html>
